# Изменено:
  - Добалена более обширная документация для всех функций


# Авторы
- **Николаев М. А.** [nikolaev.m.a7@edu.mirea.ru]
- **Федоров А. В.** [fedorov.a.v3@edu.mirea.ru]
- **Грибан М. С.** [griban.m.s@edu.mirea.ru]
- **Козлов А. И.** [alex_kozlov15@mail.ru]

---

## Методы оценки качества кластеризации

Данный документ содержит подробное описание функций для оценки качества кластеризации. Каждая функция снабжена описанием, сигнатурой, параметрами и возвращаемыми значениями.

### 1. Предварительное преобразование данных

#### 1.1. Функция `get_C()`
 
**Описание:**

Функция `get_C()` принимает на вход два списка `labels` и `points`.  Создает пустой список `C`, затем перебирает диапазон от 0 до максимального значения в `labels` и каждый раз добавляет пустой список в `C`.  После этого она перебирает диапазон длины `labels` и добавляет `points[i]` в список `C` по индексу `labels[i]-1`, затем возвращает список `C`.
	
**Сигнатура:**

```python
def get_C(labels, points) -> list:
```

**Параметры:**

- labels [list] - список кластеров для каждого объкта
- points [list] - данные, представленные в виде списка точек (объектов), где каждая точка представлена списком координат. 
	
**Возвращаемые значения:**
- С [list] - список списков объектов сгрупированных по кластерам
	
### 2. Методы анализа качества кластеризации, используемые в проекте

#### 2.1 DunneIndex

**Описание:**

Функция DunnIndex вычисляет индекс Данна с минимальным расстоянием между кластерами. Шаги функции следующие:

1. Инициализировать `mind` высоким значением (100000), а `maxd` равным 0.

2. Перебрать все пары кластеров в C, используя вложенные циклы.
	- а. Рассчитать расстояние между кластерами между текущей парой с помощью функции MinInterCluster и сохранить его в temp.
	- б. Если `temp` меньше текущего минимального расстояния (`mind`), обновить `mind`, указав `temp`.
3. Перебрать все кластеры в `C`.
	- а. Рассчитать расстояние внутри кластера для текущего кластера с помощью функции MaxIntraCluster и сохранить его в temp.
	- б. Если `temp` больше текущего максимального расстояния (`maxd`), обновить `maxd`, указав `temp`.
4. Вернуть индекс Данна, который представляет собой отношение минимального межкластерного расстояния («mind») к максимальному внутрикластерному расстоянию («maxd»).
	
**Сигнатура:**

```python
def DunnIndex(C) -> float:
```
	
**Параметры:**

С [list] - список списков объектов сгрупированных по кластерам
	
**Возвращаемые значения:**

- mind/maxd - индекс Данна

#### 2.2 DunnIndexMean
 **Описание:**
	Функция DunnIndexMean вычисляет индекс Данна с минимальным средним расстоянием между кластерами. Шаги функции следующие:

1. Инициализировать `mind` высоким значением (100000), а `maxd` равным 0.
2. Перебрать все пары кластеров в C, используя вложенные циклы.
	- а. Рассчитать расстояние между кластерами между текущей парой с помощью функции MeanInterclusterDistance и сохранить его в temp.
	- б. Если `temp` меньше текущего минимального расстояния (`mind`), обновить `mind`, указав `temp`.
3. Перебрать все кластеры в `C`.
	- а. Рассчитать расстояние внутри кластера для текущего кластера с помощью функции MaxIntraCluster и сохранить его в temp.
	- б. Если `temp` больше текущего максимального расстояния (`maxd`), обновить `maxd`, указав `temp`.
4. Вернуть индекс Данна, который представляет собой отношение минимального межкластерного расстояния («mind») к максимальному внутрикластерному расстоянию («maxd»).
	
**Сигнатура:**

```python
def DunnIndexMean(C) -> float:
```
	
**Параметры:**
С [list] - список списков объектов сгрупированных по кластерам
	
**Возвращаемые значения:**
mind/maxd - индекс Данна


### 2. Функции для вычисления метрик качества кластеризации

#### 2.1. Функция `MeanIntraclusterDistance()`

**Описание:**

Вычисляет среднее внутрикластерное расстояние для кластера с индексом `i`. Это среднее расстояние между всеми парами точек внутри кластера.

**Сигнатура:**

```python
def MeanIntraclusterDistance(C, i) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i` (*int*): Индекс кластера, для которого вычисляется метрика.

**Возвращаемое значение:**

- (*float*): Среднее внутрикластерное расстояние для кластера `i`.

**Алгоритм работы:**

1. Инициализировать сумму расстояний `sum` равной 0.
2. Рассчитать нормализующий коэффициент: `normMintra = 1 / (len(C[i]) * (len(C[i]) - 1))`.
3. Перебрать все пары точек внутри кластера `C[i]`.
4. Для каждой пары точек `(i1, j1)` (где `i1 != j1`), вычислить расстояние между ними с помощью выбранной метрики (по умолчанию евклидово расстояние).
5. Добавить расстояние к общей сумме `sum`.
6. Умножить сумму на нормализующий коэффициент `normMintra` для получения среднего значения.

---

#### 2.2. Функция `MeanInterclusterDistance()`

**Описание:**

Вычисляет среднее межкластерное расстояние между кластерами с индексами `i` и `j`. Это среднее расстояние между всеми парами точек, где одна точка из кластера `i`, а другая из кластера `j`.

**Сигнатура:**

```python
def MeanInterclusterDistance(C, i, j) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i`, `j` (*int*): Индексы кластеров, между которыми вычисляется метрика.

**Возвращаемое значение:**

- (*float*): Среднее межкластерное расстояние между кластерами `i` и `j`.

**Алгоритм работы:**

1. Инициализировать сумму расстояний `sum` равной 0.
2. Рассчитать нормализующий коэффициент: `normMinter = 1 / (len(C[i]) * len(C[j]))`.
3. Перебрать все пары точек, где первая точка `i1` из кластера `C[i]`, а вторая точка `j1` из кластера `C[j]`.
4. Вычислить расстояние между точками `i1` и `j1` с помощью выбранной метрики.
5. Добавить расстояние к общей сумме `sum`.
6. Умножить сумму на нормализующий коэффициент `normMinter` для получения среднего значения.

---

#### 2.3. Функция `MaxIntraCluster()`

**Описание:**

Находит максимальное расстояние между любыми двумя точками внутри кластера `i`. Это помогает оценить разброс точек внутри кластера.

**Сигнатура:**

```python
def MaxIntraCluster(C, i) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i` (*int*): Индекс кластера.

**Возвращаемое значение:**

- (*float*): Максимальное расстояние между любыми двумя точками внутри кластера `i`.

**Алгоритм работы:**

1. Инициализировать максимальное расстояние `maxd` равным 0.
2. Перебрать все пары точек `(i1, j1)` внутри кластера `C[i]`, где `i1 != j1`.
3. Вычислить расстояние между точками `i1` и `j1`.
4. Если вычисленное расстояние больше `maxd`, обновить `maxd`.

---

#### 2.4. Функция `MaxInterCluster()`

**Описание:**

Находит максимальное расстояние между точками из кластеров `i` и `j`. Это максимальное расстояние между точками разных кластеров.

**Сигнатура:**

```python
def MaxInterCluster(C, i, j) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i`, `j` (*int*): Индексы кластеров.

**Возвращаемое значение:**

- (*float*): Максимальное расстояние между точками из кластеров `i` и `j`.

**Алгоритм работы:**

1. Инициализировать максимальное расстояние `maxd` равным 0.
2. Перебрать все пары точек, где первая точка `i1` из кластера `C[i]`, а вторая точка `j1` из кластера `C[j]`.
3. Вычислить расстояние между точками `i1` и `j1`.
4. Если вычисленное расстояние больше `maxd`, обновить `maxd`.

---

#### 2.5. Функция `MinInterCluster()`

**Описание:**

Находит минимальное расстояние между точками из кластеров `i` и `j`. Это минимальное расстояние между точками разных кластеров, что может указывать на степень их близости.

**Сигнатура:**

```python
def MinInterCluster(C, i, j) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i`, `j` (*int*): Индексы кластеров.

**Возвращаемое значение:**

- (*float*): Минимальное расстояние между точками из кластеров `i` и `j`.

**Алгоритм работы:**

1. Инициализировать минимальное расстояние `mind` расстоянием между первыми точками кластеров `C[i][0]` и `C[j][0]`.
2. Перебрать все пары точек из кластеров `C[i]` и `C[j]`.
3. Вычислить расстояние между точками `i1` и `j1`.
4. Если вычисленное расстояние меньше `mind`, обновить `mind`.

---

#### 2.6. Функция `MeanIntraclusterDeviation()`

**Описание:**

Вычисляет среднее отклонение точек кластера `i` от его центроида. Это мера компактности кластера.

**Сигнатура:**

```python
def MeanIntraclusterDeviation(C, i) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i` (*int*): Индекс кластера.

**Возвращаемое значение:**

- (*float*): Среднее отклонение точек кластера `i` от его центроида.

**Алгоритм работы:**

1. Инициализировать центроид `mi` нулевым вектором размерности точки.
2. Суммировать координаты всех точек в кластере `C[i]` для вычисления центроида.
3. Нормализовать суммы по количеству точек, чтобы получить координаты центроида.
4. Вычислить сумму расстояний от каждой точки в кластере до центроида.
5. Разделить сумму на количество точек для получения среднего отклонения.

---

#### 2.7. Функция `MeanInterClusterDeviation()`

**Описание:**

Вычисляет среднее отклонение точек одного кластера от центроида другого кластера и наоборот. Это мера разделимости кластеров.

**Сигнатура:**

```python
def MeanInterClusterDeviation(C, i, j) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i`, `j` (*int*): Индексы кластеров.

**Возвращаемое значение:**

- (*float*): Среднее межкластерное отклонение между кластерами `i` и `j`.

**Алгоритм работы:**

1. Вычислить центроиды кластеров `i` и `j` (`mi` и `mj`).
2. Вычислить среднее расстояние от точек кластера `i` до центроида кластера `j`.
3. Вычислить среднее расстояние от точек кластера `j` до центроида кластера `i`.
4. Сложить оба значения для получения общего среднего отклонения.

---

#### 2.8. Функция `S_Intra()`

**Описание:**

Вычисляет среднее расстояние от точки `a` до всех других точек в том же кластере `i`.

**Сигнатура:**

```python
def S_Intra(C, i, a) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i` (*int*): Индекс кластера, к которому принадлежит точка `a`.
- `a` (*list*): Точка данных.

**Возвращаемое значение:**

- (*float*): Среднее внутрикластерное расстояние для точки `a`.

**Алгоритм работы:**

1. Инициализировать сумму расстояний `sum` равной 0.
2. Рассчитать нормализующий коэффициент: `norm = 1 / (len(C[i]) - 1)`.
3. Перебрать все точки `i1` в кластере `C[i]`, исключая точку `a`.
4. Вычислить расстояние между точками `a` и `i1`.
5. Суммировать расстояния и умножить на нормализующий коэффициент.

---

#### 2.9. Функция `S_Inter()`

**Описание:**

Вычисляет минимальное среднее расстояние от точки `a` до точек в других кластерах (не включая кластер `i`).

**Сигнатура:**

```python
def S_Inter(C, i, a) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i` (*int*): Индекс кластера, к которому принадлежит точка `a`.
- `a` (*list*): Точка данных.

**Возвращаемое значение:**

- (*float*): Минимальное среднее межкластерное расстояние для точки `a`.

**Алгоритм работы:**

1. Инициализировать минимальное расстояние `min` высоким значением.
2. Перебрать все кластеры `i1`, не равные `i`.
3. Для каждого кластера `i1`:
   - Инициализировать сумму расстояний `sum` равной 0.
   - Рассчитать нормализующий коэффициент: `norm = 1 / len(C[i1])`.
   - Перебрать все точки `j1` в кластере `C[i1]`.
   - Вычислить расстояние между точками `a` и `j1` и добавить к `sum`.
   - Умножить `sum` на `norm`.
   - Если `sum` меньше `min`, обновить `min`.

---

#### 2.10. Функция `silhouette()`

**Описание:**

Вычисляет коэффициент силуэта для точки `a` в кластере `i`. Коэффициент силуэта показывает, насколько хорошо точка соответствует своему кластеру по сравнению с другими кластерами. Значения находятся в диапазоне от -1 до 1.

**Сигнатура:**

```python
def silhouette(C, i, a) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i` (*int*): Индекс кластера, к которому принадлежит точка `a`.
- `a` (*list*): Точка данных.

**Возвращаемое значение:**

- (*float*): Коэффициент силуэта для точки `a`.

**Алгоритм работы:**

1. Вычислить среднее внутрикластерное расстояние `S_Intra(C, i, a)`.
2. Вычислить минимальное среднее межкластерное расстояние `S_Inter(C, i, a)`.
3. Вычислить коэффициент силуэта по формуле:
   \[
   s = \frac{S\_Inter - S\_Intra}{\max(S\_Inter, S\_Intra)}
   \]

---

#### 2.11. Функции для расчета индекса Дэвиса-Болдина (DB Index)

##### 2.11.1. Функция `normp()`

**Описание:**

Вычисляет норму порядка `p` между двумя точками `u` и `v`. Это обобщение понятия расстояния между точками.

**Сигнатура:**

```python
def normp(p, u, v) -> float:
```

**Параметры:**

- `p` (*int*): Порядок нормы (например, 1 для манхэттенского расстояния, 2 для евклидова).
- `u`, `v` (*list*): Точки данных.

**Возвращаемое значение:**

- (*float*): Значение нормы порядка `p` между точками `u` и `v`.

---

##### 2.11.2. Функция `Mi()`

**Описание:**

Вычисляет центроид (среднее значение координат) кластера `i`.

**Сигнатура:**

```python
def Mi(C, i) -> list:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i` (*int*): Индекс кластера.

**Возвращаемое значение:**

- (*list*): Координаты центроида кластера `i`.

**Алгоритм работы:**

1. Инициализировать вектор центроида `mi` нулями.
2. Суммировать соответствующие координаты всех точек в кластере `C[i]`.
3. Разделить каждую сумму на количество точек в кластере для получения среднего значения.

---

##### 2.11.3. Функция `IntraclusterSeparation()`

**Описание:**

Вычисляет внутрикластерную дисперсию для кластера `i`, используя норму порядка `p` и степень `q`.

**Сигнатура:**

```python
def IntraclusterSeparation(C, i, p, q) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `i` (*int*): Индекс кластера.
- `p` (*int*): Порядок нормы для расчета расстояния.
- `q` (*int*): Параметр степени для суммы расстояний.

**Возвращаемое значение:**

- (*float*): Внутрикластерная дисперсия кластера `i`.

**Алгоритм работы:**

1. Вычислить центроид кластера `Mi(C, i)`.
2. Инициализировать сумму расстояний `sum` равной 0.
3. Для каждой точки `i1` в кластере `C[i]` вычислить норму `normp(p, i1, M)` в степени `q` и добавить к `sum`.
4. Разделить сумму на количество точек в кластере.
5. Взять корень степени `q` из полученного значения.

---

##### 2.11.4. Функция `InterclusterSeparation()`

**Описание:**

Вычисляет расстояние между центроидами кластеров `l` и `k` с использованием нормы порядка `p`.

**Сигнатура:**

```python
def InterclusterSeparation(C, l, k, p) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `l`, `k` (*int*): Индексы кластеров.
- `p` (*int*): Порядок нормы для расчета расстояния.

**Возвращаемое значение:**

- (*float*): Расстояние между центроидами кластеров `l` и `k`.

---

#### 2.12. Функция `DBi_formula()`

**Описание:**

Вычисляет значение индекса Дэвиса-Болдина между кластерами `l` и `k`. Индекс Дэвиса-Болдина оценивает отношение внутрикластерной дисперсии к межкластерной дистанции.

**Сигнатура:**

```python
def DBi_formula(C, l, k, p, q) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `l`, `k` (*int*): Индексы кластеров.
- `p`, `q` (*int*): Параметры для расчета норм и степеней.

**Возвращаемое значение:**

- (*float*): Значение индекса Дэвиса-Болдина между кластерами `l` и `k`.

**Алгоритм работы:**

1. Вычислить внутрикластерные дисперсии `IntraclusterSeparation(C, l, p, q)` и `IntraclusterSeparation(C, k, p, q)`.
2. Вычислить межкластерное расстояние `InterclusterSeparation(C, l, k, p)`.
3. Вычислить индекс по формуле:
{DB}_{l,k} = {S_l + S_k} / {M_{l,k}}
где  S_l  и  S_k  — внутрикластерные дисперсии,  M_{l,k}  — расстояние между центроидами.

---

#### 2.13. Функция `DBi_max()`

**Описание:**

Для заданного кластера `l` находит максимальное значение индекса Дэвиса-Болдина относительно всех других кластеров.

**Сигнатура:**

```python
def DBi_max(C, p, q, l) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `p`, `q` (*int*): Параметры для расчета норм и степеней.
- `l` (*int*): Индекс кластера, для которого вычисляется максимальное значение индекса.

**Возвращаемое значение:**

- (*float*): Максимальное значение индекса Дэвиса-Болдина для кластера `l`.

**Алгоритм работы:**

1. Инициализировать максимальное значение `max` равным 0.
2. Перебрать все кластеры `i`, не равные `l`.
3. Для каждого кластера `i` вычислить индекс `DBi_formula(C, i, l, p, q)`.
4. Если вычисленное значение больше `max`, обновить `max`.

---

#### 2.14. Функция `DBi()`

**Описание:**

Вычисляет среднее значение индекса Дэвиса-Болдина для всех кластеров. Это итоговая метрика, оценивающая общую качество кластеризации.

**Сигнатура:**

```python
def DBi(C, p, q) -> float:
```

**Параметры:**

- `C` (*list*): Список кластеров.
- `p`, `q` (*int*): Параметры для расчета норм и степеней.

**Возвращаемое значение:**

- (*float*): Среднее значение индекса Дэвиса-Болдина.

**Алгоритм работы:**

1. Инициализировать сумму `sum` равной 0.
2. Перебрать все кластеры `i`.
3. Для каждого кластера вычислить `DBi_max(C, p, q, i)` и добавить к `sum`.
4. Разделить сумму на количество кластеров для получения среднего значения.

---

### 3. Используемые метрики расстояния

Функции используют различные метрики расстояния, доступные в библиотеке `scipy.spatial.distance`. По умолчанию используется евклидово расстояние (`distance.euclidean`). Возможные метрики:

- `braycurtis`
- `canberra`
- `chebyshev`
- `cityblock`
- `correlation`
- `cosine`
- `dice`
- `euclidean`
- `hamming`
- `jaccard`
- `jensenshannon`
- `kulczynski1`
- `mahalanobis`
- `matching`
- `minkowski`
- `rogerstanimoto`
- `russellrao`
- `seuclidean`
- `sokalmichener`
- `sokalsneath`
- `sqeuclidean`
- `yule`

**Примечание:** При необходимости метрику можно изменить, заменив вызовы функции `distance.euclidean` на другую метрику из списка.

---